<!DOCTYPE HTML>
<html>
<head>
	<title>pixi.js example 1</title>
	<link href='http://fonts.googleapis.com/css?family=Special+Elite' rel='stylesheet' type='text/css'>
	<style>
		body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			position: fixed;
			/*background-color: #000000;*/
			background-image: url('/img/texture/sand.jpg');
		}
		input {
			position: fixed;
			left: -10000px;
		}
		html {
			margin: 0px;
		}
	</style>
	<script src="pixi.js"></script>
	<script src="keydrown.js"></script>

</head>
<body>
	<script>
	WebFontConfig = {
	  google: { families: [ 'Special+Elite::latin' ] },
	  active: function() {
	          // do something
	          init();
	        }
	};
	(function() {
	  var wf = document.createElement('script');
	  wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
	    '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	  wf.type = 'text/javascript';
	  wf.async = 'true';
	  var s = document.getElementsByTagName('script')[0];
	  s.parentNode.insertBefore(wf, s);
	})();

	function processKeyDown(event, current_text) {
		console.log(event)
		keyCode = event.keyCode
		if (keyCode == 8) {
			current_text = current_text.substring(0, current_text.length - 1);
			event.preventDefault()
		} else if (keyCode == 32 || (keyCode >= 48 && keyCode <= 90) || (keyCode >= 186 && keyCode <= 222)) {
			// String.fromCh
			new_character = String.fromCharCode(keyCode)
			if (!event.shiftKey) {
				new_character = new_character.toLowerCase()
			}
			current_text = current_text + new_character
		}
		return current_text
	}
	
	function init() {
		// create an new instance of a pixi stage
		// var stage = new PIXI.Stage();
		var stage = new PIXI.Stage(0x66FF99);
		
		// create a renderer instance
		var renderer = PIXI.autoDetectRenderer(window.innerWidth, window.innerHeight, null, true);
		
		// add the renderer view element to the DOM
		document.body.appendChild(renderer.view);
		
		requestAnimFrame( animate );
		
		// create a texture from an image path
		var texture = PIXI.Texture.fromImage("bunny.png");
		// create a new Sprite using the texture
		var bunny = new PIXI.Sprite(texture);
		
		// center the sprites anchor point
		bunny.anchor.x = 0.5;
		bunny.anchor.y = 0.5;
		
		// move the sprite t the center of the screen
		bunny.position.x = 200;
		bunny.position.y = 150;

		var textValue = "Hi there"		
		var text = new PIXI.Text(textValue, {font:"30px Special Elite", fill:"black"});
		text.position.x = 200;
		text.position.y = 150;

		stage.addChild(text);

		stage.addChild(bunny);
		
		function animate() {
		
		    requestAnimFrame( animate );
		
		    // just for fun, lets rotate mr rabbit a little
		    bunny.rotation += 0.1;
			

		    if (kd.LEFT.isDown()) {
		    	text.position.x = text.position.x - 20
		    }
		    if (kd.RIGHT.isDown()) {
		    	text.position.x = text.position.x + 20
		    }
		    if (kd.DOWN.isDown()) {
		    	text.position.y = text.position.y + 20
		    }
		    if (kd.UP.isDown()) {
		    	text.position.y = text.position.y - 20
		    }

		    // render the stage   
		    renderer.render(stage);

		}

		function resize() {
			renderer.resize(window.innerWidth, window.innerHeight)
		}

		var element= document.getElementById('input');
		    element.focus();
		    element.onblur= function() {
		        setTimeout(function() {
		            element.focus();
		        }, 0);
		    };
		    element.onkeydown = function(e) {
		    	console.log(e)
		    	setTimeout(function () {
	    	        text.setText(e.target.value)
	    	    }, 0 );
		    }

		window.onresize = resize		
		window.onkeydown = function(e) {
			new_text = processKeyDown(e, textValue)
			textValue = new_text
			text.setText(new_text)
		}
	}


	</script>
	<input type="text" id="input">

	</body>
</html>
